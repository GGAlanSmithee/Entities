!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Entities=t()}}(function(){return function t(e,r,n){function i(o,s){if(!r[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[o]={exports:{}};e[o][0].call(l.exports,function(t){var r=e[o][1][t];return i(r?r:t)},l,l.exports,t,e,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,e,r){"use strict";function n(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(u){i=!0,a=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw a}}return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=Array.prototype.slice,s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=function(){function t(){a(this,t),this.components=new Map}return s(t,[{key:"newComponent",value:function(t){var e=this.components.get(t);if(null===e||void 0===e)return null;switch(typeof e){case"function":return new e;case"object":return function(t){var e={};return Object.keys(t).forEach(function(r){return e[r]=t[r]}),e}(e)}return e}},{key:"registerComponent",value:function(t){if(null===t||void 0===t)throw TypeError("component cannot be null.");var e=Math.max.apply(Math,i(this.components.keys())),r=void 0===e||null===e||e===-(1/0)?1:0===e?1:2*e;return this.components.set(r,t),r}},{key:"getComponents",value:function(){return this.components}}]),t}();r.ComponentManager=u;var c={Logic:0,Render:1},l=function(){function t(){a(this,t),this.logicSystems=new Map,this.renderSystems=new Map}return s(t,[{key:"registerSystem",value:function(t,e,r,n){if(t!==c.Logic&&t!==c.Render)throw TypeError("type must be a valid SystemType.");if(e!==f.Get&&e!==f.GetWith&&e!==f.GetWithOnly&&e!==f.GetWithout)throw TypeError("selector must be a valid SelectorType.");if("number"!=typeof r)throw TypeError("components must be a number.");if("function"!=typeof n)throw TypeError("callback must be a function.");var a={selector:e,components:r,callback:n},o=Math.max.apply(Math,[0].concat(i(this.logicSystems.keys()),i(this.renderSystems.keys())))+1;switch(t){case c.Logic:this.logicSystems.set(o,a);break;case c.Render:this.renderSystems.set(o,a)}return o}},{key:"removeSystem",value:function(t){return this.logicSystems["delete"](t)||this.renderSystems["delete"](t)}}]),t}();r.SystemManager=l,r.SystemType=c;var y=function(){function t(){a(this,t),this.events=new Map}return s(t,[{key:"emptyPromise",value:function(){return new Promise(function(t,e){t()})}},{key:"promise",value:function(t,e,r,n){return n?new Promise(function(a,o){setTimeout(function(){a("object"==typeof e?t.call.apply(t,[e].concat(i(r))):t.apply.apply(t,[e].concat(i(r))))},n)}):new Promise(function(n,a){n("object"==typeof e?t.call.apply(t,[e].concat(i(r))):t.apply.apply(t,[e].concat(i(r))))})}},{key:"listen",value:function(t,e){if("string"==typeof t&&"function"==typeof e){this.events.has(t)||this.events.set(t,new Map);var r=-1;return this.events.forEach(function(t){r=Math.max.apply(Math,[r].concat(i(t.keys())))}),++r,this.events.get(t).set(r,e),r}}},{key:"stopListen",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,a=this.events.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value,s=!0,u=!1,c=void 0;try{for(var l,y=o.keys()[Symbol.iterator]();!(s=(l=y.next()).done);s=!0){var f=l.value;if(f===t)return o["delete"](t)}}catch(h){u=!0,c=h}finally{try{!s&&y["return"]&&y["return"]()}finally{if(u)throw c}}}}catch(h){r=!0,n=h}finally{try{!e&&a["return"]&&a["return"]()}finally{if(r)throw n}}return!1}},{key:"trigger",value:function(){var t=this instanceof h?this.eventHandler:this,e=Array.from(arguments),r=e.splice(0,1),i=n(r,1),a=i[0];if("string"!=typeof a||!t.events.has(a))return t.emptyPromise();var o=[],s=!0,u=!1,c=void 0;try{for(var l,y=t.events.get(a).values()[Symbol.iterator]();!(s=(l=y.next()).done);s=!0){var f=l.value;o.push(t.promise(f,this,e,1))}}catch(v){u=!0,c=v}finally{try{!s&&y["return"]&&y["return"]()}finally{if(u)throw c}}return Promise.all(o)}},{key:"triggerDelayed",value:function(){var t=this instanceof h?this.eventHandler:this,e=Array.from(arguments),r=e.splice(0,2),i=n(r,2),a=i[0],o=i[1];if("string"!=typeof a||!Number.isInteger(o)||!t.events.has(a))return t.emptyPromise();var s=[],u=!0,c=!1,l=void 0;try{for(var y,f=t.events.get(a).values()[Symbol.iterator]();!(u=(y=f.next()).done);u=!0){var v=y.value;s.push(t.promise(v,this,e,o))}}catch(p){c=!0,l=p}finally{try{!u&&f["return"]&&f["return"]()}finally{if(c)throw l}}return Promise.all(s)}}]),t}();r.EventHandler=y;var f={Get:0,GetWith:1,GetWithOnly:2,GetWithout:3},h=function(){function t(){var e=void 0===arguments[0]?1e3:arguments[0];a(this,t),this.capacity=e,this.currentMaxEntity=-1,this.entityFactory=new v,this.systemManager=new l,this.componentManager=new u,this.eventHandler=new y,this.entities=Array.from({length:this.capacity},function(t){return t=0})}return s(t,[{key:"increaseCapacity",value:function(){var t=this.capacity;this.capacity*=2;for(var e=t;e<this.capacity;++e)this.entities[e]=0;var r=!0,n=!1,i=void 0;try{for(var a,o=this.componentManager.getComponents().keys()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)for(var s=a.value,e=t;e<this.capacity;++e)this[s].push(this.componentManager.newComponent(s))}catch(u){n=!0,i=u}finally{try{!r&&o["return"]&&o["return"]()}finally{if(n)throw i}}}},{key:"newEntity",value:function(t){if("number"!=typeof t||0>=t)return this.capacity;for(var e=0;e<this.capacity&&0!==this.entities[e];++e);return e>=this.capacity?this.capacity:(e>this.currentMaxEntity&&(this.currentMaxEntity=e),this.entities[e]=t,e)}},{key:"deleteEntity",value:function(t){if(this.entities[t]=0,!(t<this.currentMaxEntity))for(var e=t;e>=0;--e)if(0!==this.entities[e])return void(this.currentMaxEntity=e)}},{key:"getEntities",value:regeneratorRuntime.mark(function e(){var t,r=void 0===arguments[0]?0:arguments[0],n=void 0===arguments[1]?f.GetWith:arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next=e.t0===f.GetWith?3:e.t0===f.GetWithOnly?14:e.t0===f.GetWithout?25:e.t0===f.Get?36:46;break;case 3:e.t1=regeneratorRuntime.keys(this.entities);case 4:if((e.t2=e.t1()).done){e.next=13;break}if(t=e.t2.value,!(t>this.currentMaxEntity)){e.next=8;break}return e.abrupt("return");case 8:if(0===this.entities[t]||(this.entities[t]&r)!==r){e.next=11;break}return e.next=11,Math.floor(t);case 11:e.next=4;break;case 13:return e.abrupt("break",46);case 14:e.t3=regeneratorRuntime.keys(this.entities);case 15:if((e.t4=e.t3()).done){e.next=24;break}if(t=e.t4.value,!(t>this.currentMaxEntity)){e.next=19;break}return e.abrupt("return");case 19:if(0===this.entities[t]||this.entities[t]!==r){e.next=22;break}return e.next=22,Math.floor(t);case 22:e.next=15;break;case 24:return e.abrupt("break",46);case 25:e.t5=regeneratorRuntime.keys(this.entities);case 26:if((e.t6=e.t5()).done){e.next=35;break}if(t=e.t6.value,!(t>this.currentMaxEntity)){e.next=30;break}return e.abrupt("return");case 30:if(0===this.entities[t]||(this.entities[t]&r)===r){e.next=33;break}return e.next=33,Math.floor(t);case 33:e.next=26;break;case 35:return e.abrupt("break",46);case 36:e.t7=regeneratorRuntime.keys(this.entities);case 37:if((e.t8=e.t7()).done){e.next=45;break}if(t=e.t8.value,!(t>this.currentMaxEntity)){e.next=41;break}return e.abrupt("return");case 41:return e.next=43,Math.floor(t);case 43:e.next=37;break;case 45:return e.abrupt("break",46);case 46:case"end":return e.stop()}},e,this)})},{key:"registerComponent",value:function(t){var e=this.componentManager.registerComponent(t);this[e]=[];for(var r=0;r<this.capacity;++r)this[e].push(this.componentManager.newComponent(e));var n=void 0;switch(typeof t){case"function":n=t;break;case"object":n=function(){var e=!0,r=!1,n=void 0;try{for(var i,a=Object.keys(t)[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;this[o]=t[o]}}catch(s){r=!0,n=s}finally{try{!e&&a["return"]&&a["return"]()}finally{if(r)throw n}}};break;default:n=function(){return t}}return this.entityFactory.registerInitializer(e,n),e}},{key:"addComponent",value:function(t,e){this.entities[t]|=e}},{key:"removeComponent",value:function(t,e){this.entities[t]&=~e}},{key:"registerSystem",value:function(t,e,r,n){return this.systemManager.registerSystem(t,e,r,n)}},{key:"registerLogicSystem",value:function(t,e,r){return this.systemManager.registerSystem(c.Logic,t,e,r)}},{key:"registerRenderSystem",value:function(t,e,r){return this.systemManager.registerSystem(c.Render,t,e,r)}},{key:"removeSystem",value:function(t){return this.systemManager.removeSystem(t)}},{key:"onLogic",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,a=this.systemManager.logicSystems.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.callback.call(this,this.getEntities(o.components,o.selector),t)}}catch(s){r=!0,n=s}finally{try{!e&&a["return"]&&a["return"]()}finally{if(r)throw n}}}},{key:"onRender",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,a=this.systemManager.renderSystems.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.callback.call(this,this.getEntities(o.components,o.selector),t)}}catch(s){r=!0,n=s}finally{try{!e&&a["return"]&&a["return"]()}finally{if(r)throw n}}}},{key:"registerInitializer",value:function(t,e){this.entityFactory.registerInitializer(t,e)}},{key:"build",value:function(){return this.entityFactory.build(),this}},{key:"withComponent",value:function(t,e){return this.entityFactory.withComponent(t,e),this}},{key:"createConfiguration",value:function(){return this.entityFactory.createConfiguration()}},{key:"create",value:function(t,e){return this.entityFactory.create(this,t,e)}},{key:"listen",value:function(t,e){return this.eventHandler.listen(t,e)}},{key:"stopListen",value:function(t){return this.eventHandler.stopListen(t)}},{key:"trigger",value:function(){var t;return(t=this.eventHandler.trigger).call.apply(t,[this].concat(o.call(arguments)))}},{key:"triggerDelayed",value:function(){var t;return(t=this.eventHandler.triggerDelayed).call.apply(t,[this].concat(o.call(arguments)))}}]),t}(),v=function(){function t(){a(this,t),this.initializers=new Map,this.configuration=new Map}return s(t,[{key:"registerInitializer",value:function(t,e){Number.isInteger(t)&&"function"==typeof e&&this.initializers.set(t,e)}},{key:"build",value:function(){return this.configuration=new Map,this}},{key:"withComponent",value:function(t,e){return Number.isInteger(t)?("function"!=typeof e&&(e=this.initializers.get(t)),this.configuration.set(t,e),this):this}},{key:"createConfiguration",value:function(){return this.configuration}},{key:"create",value:function(t){var e=void 0===arguments[1]?1:arguments[1],r=void 0===arguments[2]?void 0:arguments[2];if(!(t instanceof h))return[];r=r||this.configuration;var i=0,a=!0,o=!1,s=void 0;try{for(var u,c=r.keys()[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;i|=l}}catch(y){o=!0,s=y}finally{try{!a&&c["return"]&&c["return"]()}finally{if(o)throw s}}for(var f=[],v=0;e>v;++v){var p=t.newEntity(i);if(!(p>=t.capacity)){var m=!0,g=!1,d=void 0;try{for(var k,b=r[Symbol.iterator]();!(m=(k=b.next()).done);m=!0){var w=n(k.value,2),x=w[0],M=w[1];if("function"==typeof M){var S=M.call(t[x][p]);"function"!=typeof t[x][p]&&"object"!=typeof t[x][p]&&void 0!==S&&(t[x][p]=S)}}}catch(y){g=!0,d=y}finally{try{!m&&b["return"]&&b["return"]()}finally{if(g)throw d}}f.push(p)}}return 1===f.length?f[0]:f}}]),t}();r.EntityManager=h,r.SelectorType=f},{}]},{},[1])(1)});